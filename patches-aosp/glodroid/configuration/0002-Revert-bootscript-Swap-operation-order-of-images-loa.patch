From a996a33f02e8627c16be38b99f8612af9711bf27 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Micha=C5=82=20Gapi=C5=84ski?= <mike@gapinski.eu>
Date: Wed, 10 Jan 2024 23:04:24 +0000
Subject: [PATCH 02/10] Revert "bootscript: Swap operation order of images load
 and AVB verification"

This reverts commit 12e8feac0deaeb2411d9231d65a356b6f30fb90d.
---
 platform/uboot/bootscript.cpp | 11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

diff --git a/platform/uboot/bootscript.cpp b/platform/uboot/bootscript.cpp
index dc1ffeb..ff216a4 100644
--- a/platform/uboot/bootscript.cpp
+++ b/platform/uboot/bootscript.cpp
@@ -155,12 +155,6 @@ FUNC_BEGIN(bootcmd_block)
  DEVICE_HANDLE_BUTTONS()
 #endif
  run bootcmd_bcb
-
- abootimg load mmc \$mmc_bootdev boot        \${slot_name}
- abootimg load mmc \$mmc_bootdev init_boot   \${slot_name}
- abootimg load mmc \$mmc_bootdev vendor_boot \${slot_name}
- abootimg load mmc \$mmc_bootdev dtbo        \${slot_name}
-
  if test STRESC(\$androidrecovery) = STRESC("true");
  then
   /* Always unlock device for fastbootd and recovery modes, otherwise fastbootd flashing won't work. TODO: Support conditional lock/unlock */
@@ -168,6 +162,11 @@ FUNC_BEGIN(bootcmd_block)
  else
   run bootcmd_avb;
  fi;
+
+ abootimg load mmc \$mmc_bootdev boot        \$slot_name
+ abootimg load mmc \$mmc_bootdev init_boot   \$slot_name
+ abootimg load mmc \$mmc_bootdev vendor_boot \$slot_name
+ abootimg load mmc \$mmc_bootdev dtbo        \$slot_name
 FUNC_END()
 
 FUNC_BEGIN(rename_and_expand_userdata_placeholder)
-- 
2.34.1

