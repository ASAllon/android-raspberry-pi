From 4486671dc36aa7a2dc2bba88f77c9bd3952fae41 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Micha=C5=82=20Gapi=C5=84ski?= <mike@gapinski.eu>
Date: Wed, 10 Jan 2024 23:04:55 +0000
Subject: [PATCH 05/10] Revert "common: Add the FRP partition"

This reverts commit f6d08472cbe81e63a7bf7aaa75fb90eb641cee2f.
---
 common/base/device.mk         | 3 ---
 common/base/ueventd.common.rc | 3 ---
 platform/tools/flash-all.sh   | 1 -
 platform/tools/gensdimg.sh    | 1 -
 platform/uboot/bootscript.cpp | 1 -
 5 files changed, 9 deletions(-)

diff --git a/common/base/device.mk b/common/base/device.mk
index df473b6..29113d0 100644
--- a/common/base/device.mk
+++ b/common/base/device.mk
@@ -76,6 +76,3 @@ PRODUCT_PACKAGES += \
     update_engine_sideload \
 
 TARGET_FLATTEN_APEX := true
-
-# ro.frp.pst points to a partition that contains factory reset protection information.
-PRODUCT_VENDOR_PROPERTIES += ro.frp.pst=/dev/block/by-name/frp
diff --git a/common/base/ueventd.common.rc b/common/base/ueventd.common.rc
index 071c05a..7f71537 100644
--- a/common/base/ueventd.common.rc
+++ b/common/base/ueventd.common.rc
@@ -17,6 +17,3 @@ subsystem usbmisc
 
 # USB Gadget HAL v1.2
 /sys/class/udc*                          current_speed 0644    system       system
-
-# Storage: for factory reset protection feature
-/dev/block/by-name/frp                                 0660    system       system
diff --git a/platform/tools/flash-all.sh b/platform/tools/flash-all.sh
index 2071092..db439b7 100755
--- a/platform/tools/flash-all.sh
+++ b/platform/tools/flash-all.sh
@@ -24,7 +24,6 @@ set -x
 ./fastboot flash vbmeta_a        vbmeta.img
 ./fastboot flash vbmeta_system_a vbmeta_system.img
 ./fastboot erase misc
-./fastboot erase frp
 
 ./fastboot reboot-fastboot
 
diff --git a/platform/tools/gensdimg.sh b/platform/tools/gensdimg.sh
index 3bdc604..bc46619 100755
--- a/platform/tools/gensdimg.sh
+++ b/platform/tools/gensdimg.sh
@@ -71,7 +71,6 @@ gen_image() {
     fi
 
     ${PARTED_TOOL} add_partition ${BASE_ARGS} --partition-name=misc                  --size=512K
-    ${PARTED_TOOL} add_partition ${BASE_ARGS} --partition-name=frp                   --size=512K
     ${PARTED_TOOL} add_image     ${BASE_ARGS} --partition-name=boot_a                --size=64M  --img-file=boot.img
     ${PARTED_TOOL} add_partition ${BASE_ARGS} --partition-name=boot_b                --size=64M
     ${PARTED_TOOL} add_image     ${BASE_ARGS} --partition-name=vendor_boot_a         --size=32M  --img-file=vendor_boot.img
diff --git a/platform/uboot/bootscript.cpp b/platform/uboot/bootscript.cpp
index 35f3367..b4bc643 100644
--- a/platform/uboot/bootscript.cpp
+++ b/platform/uboot/bootscript.cpp
@@ -29,7 +29,6 @@ EXTENV(partitions, ";name=bootloader,start=128K,size=130944K,uuid=\${uuid_gpt_bo
 #endif
 EXTENV(partitions, ";name=uboot-env,size=512K,uuid=\${uuid_gpt_reserved}")
 EXTENV(partitions, ";name=misc,size=512K,uuid=\${uuid_gpt_misc}")
-EXTENV(partitions, ";name=frp,size=512K,uuid=\${uuid_gpt_frp}")
 EXTENV(partitions, ";name=boot_a,size=64M,uuid=\${uuid_gpt_boot_a}")
 EXTENV(partitions, ";name=boot_b,size=64M,uuid=\${uuid_gpt_boot_b}")
 EXTENV(partitions, ";name=vendor_boot_a,size=32M,uuid=\${uuid_gpt_vendor_boot_a}")
-- 
2.34.1

